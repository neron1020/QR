<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Ficha Producto Galilea</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2em; background: #f9f9f9; }
        .logo { position: absolute; top: 20px; right: 20px; width: 150px; }
        .card { background: white; padding: 2em; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 700px; margin: auto; }
        h2 { color: #c8102e; font-size: 32px; margin-bottom: 20px; }
        p { font-size: 14px; margin: 6px 0; }
    </style>
</head>
<body>
    <img src="../logo.jpg" alt="Logo" class="logo" />
    <div class="card">
        <h2>Ficha del Producto</h2>
        <div id="contenido">Cargando...</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        async function cargarDatos() {
            const codigo = getQueryParam("codigo");
            if (!codigo) {
                document.getElementById("contenido").innerText = "No se proporcionó código en la URL.";
                return;
            }

            const csvUrl = "https://raw.githubusercontent.com/neron1020/QR/main/stock_critico_master.csv";

            try {
                const response = await fetch(csvUrl);
                if (!response.ok) throw new Error("No se pudo cargar el CSV.");

                const csv = await response.text();

                Papa.parse(csv, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        const data = results.data;
                        // Filtra ignorando mayúsculas/minúsculas en 'llave'
                        const producto = data.find(row => row.llave && row.llave.toLowerCase() === codigo.toLowerCase());

                        if (producto) {
                            let html = "";
                            for (const campo in producto) {
                                // Excluir campos 'llave' y 'stock minimo'
                                if (campo.toLowerCase() !== "llave" && campo.toLowerCase() !== "stock minimo" && producto[campo]) {
                                    let valor = producto[campo];
                                    // Ejemplo de mostrar número entero para algunos campos
                                    if (campo.toLowerCase().includes("etapa") || campo.toLowerCase().includes("cantidad")) {
                                        if (!isNaN(valor)) {
                                            valor = parseInt(valor);
                                        }
                                    }
                                    html += `<p><strong>${campo}:</strong> ${valor}</p>`;
                                }
                            }
                            document.getElementById("contenido").innerHTML = html;
                        } else {
                            document.getElementById("contenido").innerText = "Producto no encontrado.";
                        }
                    }
                });
            } catch (error) {
                document.getElementById("contenido").innerText = "Error al cargar los datos.";
                console.error(error);
            }
        }

        cargarDatos();
    </script>
</body>
</html>
